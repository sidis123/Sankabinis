@{
    ViewBag.Title = "Match";
    var raceId = ViewBag.RaceId;
    var loggedInUserId = ViewBag.LoggedInUserId;
    var username = Context.Session.GetString("Username");
}

<h2>Race ID: @raceId</h2>

@if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
{
    <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
}
else
{
    <div class="form-group">
        <form id="matchForm">
            <div class="form-check">
                <input type="radio" name="result" id="won" value="1" class="form-check-input" />
                <label class="form-check-label" for="won">I won the race</label>
            </div>
            <div class="form-check">
                <input type="radio" name="result" id="lost" value="0" class="form-check-input" />
                <label class="form-check-label" for="lost">I lost the race</label>
            </div>
            <div>
                <button type="button" id="submitResult" class="btn btn-primary" disabled>Submit Result</button>
            </div>
        </form>
    </div>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#submitResult').prop('disabled', true);

            $('input[name="result"]').change(function () {
                $('#submitResult').prop('disabled', false);
            });

            $('#submitResult').click(function () {
                var selectedResult = $('input[name="result"]:checked').val();
                var userId = '@loggedInUserId';
                var raceId = '@raceId';

                if (selectedResult === undefined) {
                    alert('Please select a result.');
                    return;
                }

                $.ajax({
                    url: '@Url.Action("RegisterResult", "Race")',
                    type: 'POST',
                    data: {
                        userId: userId,
                        result: selectedResult,
                        raceId: raceId
                    },
                    success: function (response) {
                        if (response.success) {
                            alert('Result registered successfully.');
                        } else {
                            alert('Failed to register result: ' + response.message);
                        }
                    },
                    error: function () {
                        alert('An error occurred while registering the result.');
                    }
                });
            });
        });
    </script>
}
